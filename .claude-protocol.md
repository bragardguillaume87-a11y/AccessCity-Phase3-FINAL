# ü§ñ Protocole Claude - AccessCity Studio

> **Version:** 1.0.0
> **Derni√®re mise √† jour:** 2026-02-01
> **Auteur:** Claude Sonnet 4.5 + Guillaume Bragard

## üìã Table des mati√®res

1. [Introduction](#introduction)
2. [Philosophie g√©n√©rale](#philosophie-g√©n√©rale)
3. [Workflow de d√©veloppement](#workflow-de-d√©veloppement)
4. [Protocole d'audit et corrections](#protocole-daudit-et-corrections)
5. [Protocole de planification](#protocole-de-planification)
6. [Standards de code](#standards-de-code)
7. [Accessibilit√© (WCAG 2.2 AA)](#accessibilit√©-wcag-22-aa)
8. [Git et commits](#git-et-commits)
9. [Communication](#communication)
10. [Invocation du protocole](#invocation-du-protocole)

---

## Introduction

Ce document d√©finit le **protocole de travail standardis√©** entre Claude (assistant IA) et l'√©quipe de d√©veloppement AccessCity. L'objectif est d'assurer une **qualit√© constante**, une **tra√ßabilit√© compl√®te** et une **efficacit√© maximale** dans le d√©veloppement du projet AccessCity Studio.

Le protocole peut √™tre invoqu√© via la commande : **`claude proto [√©tape]`**

Exemple : `claude proto audit` pour lancer un audit de code.

---

## Philosophie g√©n√©rale

### Principes fondamentaux

1. **Accessibilit√© d'abord** : AccessCity vise l'inclusion totale. Chaque fonctionnalit√© doit √™tre utilisable par TOUS, y compris les personnes en situation de handicap.
2. **Gaming aesthetic** : Interface moderne, agr√©able et "fun" tout en restant professionnelle.
3. **Clean Architecture** : S√©paration claire entre logique m√©tier, UI et √©tat.
4. **Performance** : Minimiser les re-renders, optimiser les imports, utiliser lazy loading.
5. **Tra√ßabilit√©** : Commits atomiques, messages descriptifs, documentation inline.

### Valeurs cl√©s

- **Qualit√© > Vitesse** : Mieux vaut prendre le temps de bien faire que de livrer du code cass√©.
- **Documentation > M√©moire** : Documenter pour ne jamais d√©pendre de l'historique de conversation.
- **Tests > Debugging** : Anticiper les bugs plut√¥t que les corriger apr√®s coup.
- **Communication claire** : Fran√ßais pour l'utilisateur, anglais pour le code et les commentaires techniques.

---

## Workflow de d√©veloppement

### 1. R√©ception de la demande

1. **Lire attentivement** la demande de l'utilisateur
2. **Poser des questions** si quelque chose n'est pas clair (via `AskUserQuestion`)
3. **Identifier le type de t√¢che** :
   - üêõ Bug fix
   - ‚ú® Nouvelle fonctionnalit√©
   - ‚ôªÔ∏è Refactoring
   - üìù Documentation
   - üé® Design/UI

### 2. Planification (si t√¢che complexe)

Si la t√¢che implique :
- Plus de 3 fichiers modifi√©s
- Architecture √† concevoir
- Plusieurs approches possibles

‚û°Ô∏è **Utiliser `EnterPlanMode`** pour cr√©er un plan d√©taill√© et le faire valider.

**Ne PAS** entrer en plan mode pour :
- Bugs simples (1-2 lignes)
- Modifications cosm√©tiques
- T√¢ches de recherche

### 3. Ex√©cution

1. **Cr√©er une TODO list** (via `TodoWrite`) pour tracer la progression
2. **Lire les fichiers n√©cessaires** avant toute modification
3. **Impl√©menter** en suivant les standards de code
4. **Tester mentalement** : anticiper les edge cases
5. **Marquer les TODOs comme compl√©t√©s** au fur et √† mesure

### 4. V√©rification

1. **Auto-review** : relire le code produit
2. **V√©rifier l'accessibilit√©** : ARIA, keyboard nav, screen reader
3. **V√©rifier la coh√©rence** : design, naming, patterns
4. **Nettoyer** : supprimer les console.log, commentaires inutiles

### 5. Commit

1. **Staging s√©lectif** : `git add <fichiers>` (pas de `git add .`)
2. **Message descriptif** en fran√ßais avec `Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>`
3. **Git status** apr√®s commit pour v√©rifier

---

## Protocole d'audit et corrections

**Commande :** `claude proto audit`

### √âtapes de l'audit

#### 1. Analyse du probl√®me

1. **Reproduire le bug** mentalement ou avec screenshots
2. **Identifier les sympt√¥mes** vs la cause racine
3. **Formuler des hypoth√®ses** sur l'origine du probl√®me

#### 2. Investigation

1. **Lire les fichiers concern√©s** (utiliser `Read`, `Grep`, `Glob`)
2. **Tracer le flow de donn√©es** : d'o√π vient la donn√©e, o√π va-t-elle ?
3. **Chercher les patterns suspects** :
   - State mutations directes
   - Re-renders inutiles
   - D√©pendances manquantes dans `useEffect`
   - Props drilling excessif
   - Conditions de course (race conditions)

#### 3. Debug instrumental

1. **Ajouter des `console.log` strat√©giques** avec pr√©fixe `[NomComposant]`
2. **Demander des screenshots** si besoin
3. **Analyser les logs** fournis par l'utilisateur

#### 4. Diagnostic

1. **Confirmer la cause racine**
2. **√âvaluer l'impact** : fichiers touch√©s, risques de r√©gression
3. **Proposer une solution** (ou plusieurs si pertinent)

#### 5. Correction

1. **Impl√©menter le fix** en suivant les standards
2. **Nettoyer les console.log** ajout√©s
3. **V√©rifier les side effects** : est-ce que √ßa casse autre chose ?

#### 6. Validation

1. **Demander confirmation** √† l'utilisateur que le bug est r√©solu
2. **Commit atomique** avec message explicite (ex: `fix(dialogue): insert responses after main dialogue in edit mode`)

---

## Protocole de planification

**Commande :** `claude proto plan`

### Quand cr√©er un plan ?

- Nouvelle fonctionnalit√© complexe (3+ fichiers)
- Refactoring architectural
- Int√©gration de librairie externe
- Plusieurs approches possibles

### Structure du plan

1. **üéØ Objectif** : Description claire et concise
2. **üîç Analyse de l'existant** : Architecture actuelle, patterns utilis√©s
3. **üìã Plan d'impl√©mentation** :
   - PHASE 1, PHASE 2, etc.
   - Pour chaque phase : fichiers √† cr√©er/modifier, √©tapes d√©taill√©es
4. **üìÅ Fichiers concern√©s** : Liste exhaustive
5. **üß™ Tests & v√©rifications** : Checklist de validation
6. **‚ö†Ô∏è Risques identifi√©s** : Points d'attention, impacts

### Validation du plan

1. **Pr√©senter le plan** √† l'utilisateur via `ExitPlanMode`
2. **Ajuster** selon le feedback
3. **Commencer l'impl√©mentation** seulement apr√®s approbation

---

## Standards de code

### Naming conventions

- **Components** : PascalCase (`DialogueGraph`, `StepReview`)
- **Functions** : camelCase (`handleSave`, `updateDialogue`)
- **Constants** : UPPER_SNAKE_CASE (`DEFAULTS.DIALOGUE_SPEAKER`)
- **Files** : PascalCase pour composants, camelCase pour utils
- **CSS Classes** : kebab-case ou Tailwind utility classes

### Architecture

```
src/
‚îú‚îÄ‚îÄ components/          # UI Components
‚îÇ   ‚îú‚îÄ‚îÄ ui/             # Shadcn/ui base components
‚îÇ   ‚îú‚îÄ‚îÄ features/       # Feature-specific components (DialogueGraph)
‚îÇ   ‚îú‚îÄ‚îÄ modals/         # Modal components
‚îÇ   ‚îî‚îÄ‚îÄ panels/         # Panel components (LeftPanel, MainCanvas)
‚îú‚îÄ‚îÄ stores/             # Zustand stores (uiStore, scenesStore)
‚îú‚îÄ‚îÄ hooks/              # Custom React hooks
‚îú‚îÄ‚îÄ factories/          # Factory patterns (DialogueFactory)
‚îú‚îÄ‚îÄ types/              # TypeScript type definitions
‚îú‚îÄ‚îÄ config/             # Configuration (constants, theme)
‚îî‚îÄ‚îÄ utils/              # Utility functions
```

### React patterns

1. **Hooks au top du composant** dans cet ordre :
   - State hooks (`useState`)
   - Zustand selectors (`useUIStore`)
   - Custom hooks (`useDialogueGraph`)
   - Effects (`useEffect`)

2. **Handlers en dessous** :
   ```tsx
   const handleSave = useCallback(() => {
     // ...
   }, [dependencies]);
   ```

3. **Render helpers** (si n√©cessaire) :
   ```tsx
   const renderStepContent = () => {
     switch (step) {
       case 'complexity': return <StepComplexity />;
       // ...
     }
   };
   ```

4. **Return JSX √† la fin**

### TypeScript

- **Typage explicite** pour les props et return types des fonctions
- **Interfaces** pour les objets complexes
- **Types** pour les unions et alias
- **√âviter `any`** : pr√©f√©rer `unknown` ou typage pr√©cis

### Imports

```tsx
// 1. React & libraries
import React, { useState, useCallback } from 'react';
import { X, Play } from 'lucide-react';

// 2. Components (UI d'abord, puis features)
import { Button } from '@/components/ui/button';
import { DialogueGraph } from '@/components/features/DialogueGraph';

// 3. Stores & hooks
import { useUIStore, useScenesStore } from '@/stores';
import { useDialogueGraph } from '@/hooks/useDialogueGraph';

// 4. Types
import type { Dialogue, Scene } from '@/types';

// 5. Config & utils
import { DEFAULTS } from '@/config/constants';
```

---

## Accessibilit√© (WCAG 2.2 AA)

**Principe :** Chaque fonctionnalit√© doit √™tre utilisable par tous, y compris les personnes en situation de handicap.

### Checklist obligatoire

#### 1. Keyboard Navigation (WCAG 2.1.1)

- [ ] **Tab/Shift+Tab** : Navigation entre √©l√©ments interactifs
- [ ] **Enter/Space** : Activation d'√©l√©ments
- [ ] **Arrows** : Navigation dans listes/menus
- [ ] **Escape** : Fermeture de modales/menus
- [ ] **Focus visible** : Outline cyan 3px (`focus-visible:outline`)

#### 2. Screen Reader Support (WCAG 2.4.3, 2.4.6)

- [ ] **ARIA labels** : `aria-label` sur tous les boutons avec ic√¥nes uniquement
- [ ] **ARIA live regions** : Annoncer les changements dynamiques
- [ ] **Semantic HTML** : `<button>`, `<nav>`, `<main>`, etc.
- [ ] **Hidden text** : `.sr-only` pour contexte screen reader
- [ ] **Role attributes** : `role="banner"`, `role="main"`, etc.

#### 3. Color & Contrast (WCAG 1.4.3)

- [ ] **Contraste minimum** : 4.5:1 pour texte normal, 3:1 pour large
- [ ] **Pas de couleur seule** : Utiliser ic√¥nes + couleur
- [ ] **Mode high contrast** : Pr√©voir un mode sans gradients

#### 4. Motor Disabilities (WCAG 2.5.5)

- [ ] **Large click targets** : Minimum 44√ó44px
- [ ] **No drag-only** : Alternative clavier pour drag & drop
- [ ] **No timing** : Pas de timeouts obligatoires

#### 5. Cognitive Disabilities

- [ ] **Simple language** : Phrases courtes et claires
- [ ] **Visual hierarchy** : Headings (h1, h2, h3)
- [ ] **Consistent patterns** : UI pr√©visible
- [ ] **Error messages** : Explicites et constructifs

### Modes alternatifs (pour √©diteur nodal)

1. **Mode visuel** (default) : Drag & drop, souris
2. **Mode clavier** (`Ctrl+K`) : Navigation 100% clavier
3. **Mode liste** (`Ctrl+L`) : Vue textuelle hi√©rarchique pour screen readers
4. **Mode high contrast** (`Ctrl+H`) : Couleurs solides, bordures √©paisses

---

## Git et commits

### Workflow Git

```bash
# 1. V√©rifier l'√©tat
git status

# 2. Ajouter les fichiers modifi√©s (PAS de git add .)
git add src/components/modals/DialogueGraphModal.tsx
git add src/stores/uiStore.ts

# 3. Commit avec message descriptif
git commit -m "$(cat <<'EOF'
feat(graph-modal): add full-screen node editor modal

- Add DialogueGraphModal component (95vw √ó 95vh)
- Add graph modal state to uiStore (Zustand)
- Add "Vue Graphe" button in TopBar (gaming-accent variant)
- Connect TopBar button to modal via handleOpenModal
- Graph displays existing DialogueGraph component
- Prepared for PHASE 2 (interactive editing)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
EOF
)"

# 4. V√©rifier le commit
git log -1 --stat
```

### Format du message de commit

```
type(scope): short description

- Bullet point 1
- Bullet point 2
- Bullet point 3

Additional context if needed (optional).

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**Types :**
- `feat`: Nouvelle fonctionnalit√©
- `fix`: Correction de bug
- `refactor`: Refactoring sans changement fonctionnel
- `docs`: Documentation
- `style`: Formatting, whitespace
- `test`: Ajout/modification de tests
- `chore`: Maintenance (build, deps)

**Scopes :** `dialogue-wizard`, `graph-modal`, `ui-store`, `accessibility`, etc.

### R√®gles Git Safety

- ‚ùå **JAMAIS** `git add .` ou `git add -A` (risque de commiter .env, credentials)
- ‚ùå **JAMAIS** `git commit --amend` (sauf si explicitement demand√©)
- ‚ùå **JAMAIS** `git push --force` sur main/master
- ‚ùå **JAMAIS** `--no-verify` (skip hooks)
- ‚úÖ **TOUJOURS** `git add <fichiers>` explicitement
- ‚úÖ **TOUJOURS** v√©rifier `git status` avant/apr√®s commit

---

## Communication

### Langue

- **Utilisateur** : Fran√ßais (messages, explications)
- **Code** : Anglais (variables, fonctions, commentaires techniques)
- **Commits** : Fran√ßais (descriptions) + Anglais (short description)

### Ton et style

- **Concis** : √âviter les longs paragraphes
- **Objectif** : Facts over feelings, pas de superlatives excessifs
- **Clair** : Markdown pour structurer les r√©ponses
- **Actionable** : Donner des √©tapes concr√®tes
- **Pas de `console.log` pour communiquer** : Utiliser le texte de r√©ponse

### Emojis

- ‚ùå **Jamais dans le code** (sauf si demand√© explicitement)
- ‚úÖ **OK dans les r√©ponses** pour structurer (üéØ, ‚úÖ, ‚ùå, üìã, etc.)
- ‚úÖ **OK dans les commits** (occasionnellement pour visibilit√©)

### Questions √† l'utilisateur

Utiliser `AskUserQuestion` pour :
- Clarifier une ambigu√Øt√©
- Choisir entre plusieurs approches
- Valider une d√©cision importante

**Ne PAS** demander :
- "Est-ce que le plan est OK ?" ‚Üí Utiliser `ExitPlanMode`
- "Dois-je continuer ?" ‚Üí Continuer sauf indication contraire
- Questions √©videntes ‚Üí Prendre l'initiative

---

## Invocation du protocole

### Commandes disponibles

L'utilisateur peut invoquer ce protocole via :

```bash
claude proto                  # Afficher ce document
claude proto audit            # Lancer un audit de code
claude proto plan             # Cr√©er un plan d'impl√©mentation
claude proto fix <bug>        # Corriger un bug avec le protocole
claude proto commit           # Rappel des r√®gles de commit
claude proto a11y             # Checklist accessibilit√©
```

### Mise √† jour du protocole

Ce fichier peut √™tre mis √† jour au fil du projet. Lors de modifications :

1. Incr√©menter le num√©ro de version (SemVer : MAJOR.MINOR.PATCH)
2. Mettre √† jour la date "Derni√®re mise √† jour"
3. Ajouter une section CHANGELOG en bas du fichier (optionnel)

---

## Annexes

### Ressources utiles

- **WCAG 2.2** : https://www.w3.org/WAI/WCAG22/quickref/
- **ReactFlow Docs** : https://reactflow.dev/
- **Zustand Docs** : https://docs.pmnd.rs/zustand/
- **Tailwind CSS** : https://tailwindcss.com/docs
- **Radix UI** : https://www.radix-ui.com/

### Outils CLI

- `git status` : √âtat du repo
- `git diff <file>` : Voir les changements
- `git log -1 --stat` : Dernier commit avec stats
- `npm run dev` : Lancer le serveur de dev
- `npm run build` : Build de production
- `npm run lint` : Linter ESLint

---

**Fin du protocole Claude v1.0.0**

Ce protocole est un document vivant. N'h√©sitez pas √† le faire √©voluer selon les besoins du projet ! üöÄ
