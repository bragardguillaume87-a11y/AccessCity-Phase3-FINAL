<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests Phase 3 - AccessCity Scene Editor</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
        }
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        #console {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            padding: 20px;
            min-height: 400px;
            font-size: 14px;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 80vh;
        }
        .pass {
            color: #4ec9b0;
        }
        .fail {
            color: #f48771;
        }
        .info {
            color: #dcdcaa;
        }
        .header {
            color: #569cd6;
            font-weight: bold;
        }
        .section {
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #3e3e42;
        }
    </style>
</head>
<body>
    <h1>Tests Automatises Phase 3</h1>
    <p>Execution des tests pour core/ (sanitizer, eventBus, schema)...</p>
    <div id="console"></div>

    <script type="module">
        // Rediriger console.log vers DOM
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        
        // Restaurer console en cas d'erreur globale
        window.addEventListener('error', (event) => {
            console.log = originalLog;
            console.error = originalError;
            console.error('[FATAL] Erreur non geree:', event.message);
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.log = originalLog;
            console.error = originalError;
            console.error('[FATAL] Promise rejetee:', event.reason);
        });
        
        console.log = function(...args) {
            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    return JSON.stringify(arg, null, 2);
                }
                return String(arg);
            }).join(' ');
            
            const line = document.createElement('div');
            
            if (message.includes('PASS')) {
                line.className = 'pass';
            } else if (message.includes('FAIL') || message.includes('ERROR')) {
                line.className = 'fail';
            } else if (message.includes('====')) {
                line.className = 'header';
            } else if (message.includes('[TEST]') || message.includes('[SANITIZER]') || message.includes('[EVENTBUS]') || message.includes('[SCHEMA]')) {
                line.className = 'info';
            }
            
            line.textContent = message;
            consoleDiv.appendChild(line);
            
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            const message = args.map(arg => String(arg)).join(' ');
            const line = document.createElement('div');
            line.className = 'fail';
            line.textContent = message;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            originalError.apply(console, args);
        };
        
        // Importer et lancer tests
        import('./test-phase3.js').catch(err => {
            console.error('Erreur import test-phase3.js:', err);
            console.log = originalLog;
            console.error = originalError;
        });
    </script>
</body>
</html>
